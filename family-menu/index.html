<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å®¶åº­é¦–é¡µ</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>ğŸ¡ å®¶åº­ç”Ÿæ´»ä¸­å¿ƒ</header>

  <main>
    <section class="section">
      <h2>ğŸ“… æ—¥æœŸä¸å¤©æ°”</h2>
      <p id="dateDisplay"></p>
      <p id="locationDisplay">æ­£åœ¨è·å–ä½ç½®...</p>
      <p id="weatherDisplay">åŠ è½½å¤©æ°”ä¸­...</p>
    </section>

    <section class="section">
      <h2>ğŸ“ ä»Šæ—¥å¾…åŠ</h2>
      <form id="todoForm">
        <input type="text" id="todoInput" placeholder="è¾“å…¥å¾…åŠäº‹é¡¹" required>
        <button type="submit">æ·»åŠ </button>
      </form>
      <ul id="todoList"></ul>
    </section>

    <div class="bottom-btn">
      <a href="menu.html">ğŸš å°è±å¹²é¥­</a>
    </div>
  </main>

  <script src="app.js"></script>
  <script>
    // ===== æ—¥æœŸæ˜¾ç¤º =====
    const dateEl = document.getElementById('dateDisplay');
    const today = new Date();
    dateEl.textContent = today.toLocaleDateString('zh-CN', {
      weekday: 'long', year: 'numeric', month: 'long', day: 'numeric'
    });

    // ===== å¤©æ°” & åœ°ç†ä½ç½® =====
    const locationEl = document.getElementById('locationDisplay');
    const weatherEl = document.getElementById('weatherDisplay');

    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(async pos => {
        const { latitude, longitude } = pos.coords;
        locationEl.textContent = `ğŸ“ åæ ‡ï¼š${latitude.toFixed(2)}, ${longitude.toFixed(2)}`;
        const url = `https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&current_weather=true`;
        const res = await fetch(url);
        const data = await res.json();
        const w = data.current_weather;
        weatherEl.textContent = `ğŸŒ¤ å½“å‰æ¸©åº¦ï¼š${w.temperature}Â°Cï¼Œé£é€Ÿ ${w.windspeed} km/h`;
      }, () => {
        locationEl.textContent = "âš ï¸ æ— æ³•è·å–ä½ç½®ä¿¡æ¯";
        weatherEl.textContent = "æ— æ³•åŠ è½½å¤©æ°”";
      });
    } else {
      locationEl.textContent = "è®¾å¤‡ä¸æ”¯æŒå®šä½";
    }

    // ===== å¾…åŠäº‹é¡¹ =====
    const todoForm = document.getElementById('todoForm');
    const todoInput = document.getElementById('todoInput');
    const todoList = document.getElementById('todoList');
    const todos = JSON.parse(localStorage.getItem('todos')) || [];

    function renderTodos() {
      todoList.innerHTML = '';
      todos.forEach((t, i) => {
        const li = document.createElement('li');
        li.textContent = t;
        li.addEventListener('click', () => {
          todos.splice(i, 1);
          localStorage.setItem('todos', JSON.stringify(todos));
          renderTodos();
        });
        todoList.appendChild(li);
      });
    }

    todoForm.addEventListener('submit', e => {
      e.preventDefault();
      const text = todoInput.value.trim();
      if (text) {
        todos.push(text);
        localStorage.setItem('todos', JSON.stringify(todos));
        renderTodos();
        todoInput.value = '';
      }
    });

    renderTodos();
  </script>
</body>
</html>
