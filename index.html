<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>3D 实时天气（Three.js）</title>
<style>
  html,body{height:100%;margin:0;background:#000;overflow:hidden;font-family:Inter,Arial,sans-serif}
  #ui {
    position: absolute; z-index: 10; left: 16px; top: 16px;
    color: #fff; backdrop-filter: blur(6px); background: rgba(0,0,0,0.25);
    padding: 12px; border-radius: 10px; min-width: 320px;
  }
  #ui input { width: 180px; padding: 8px; border-radius: 6px; border: none; margin-right:6px; background: rgba(255,255,255,0.06); color:#fff }
  #ui button { padding: 8px 10px; border-radius:6px; border:none; cursor:pointer; background: rgba(255,255,255,0.06); color:#fff }
  #info { margin-top:8px; font-size:13px; color:#ddd }
  #credits { position: absolute; z-index: 10; right: 14px; bottom: 14px; color: rgba(255,255,255,0.7); font-size:12px; }
  .small { font-size:12px; color:#cfcfcf }
  @media (max-width:520px){ #ui{left:8px;right:8px;min-width:auto;width:calc(100% - 16px)} }
</style>
</head>
<body>
<div id="ui">
  <div style="display:flex;align-items:center;gap:6px;">
    <input id="q" placeholder="城市名或 lat,lon (例如：Adelaide 或 -34.92,138.60)">
    <button id="search">查询</button>
    <button id="loc">定位</button>
  </div>
  <div id="info">
    <div id="place">加载中…</div>
    <div id="weatherText" class="small">—</div>
    <div id="temp" class="small">—</div>
  </div>
</div>
<div id="credits">数据：WeatherAPI · 渲染：Three.js</div>

<!-- Three.js (r152 or latest) -->
<script src="https://unpkg.com/three@0.152.2/build/three.min.js"></script>
<script src="https://unpkg.com/three@0.152.2/examples/js/controls/OrbitControls.js"></script>

<script>
/* ================= CONFIG ================= */
const API_KEY = "0871934c91a1479984b40316250912"; // ← 如需替换在这里改
const DEFAULT_PLACE = "Adelaide";
/* =============== END CONFIG =============== */

/* ============ 基础 Three.js 场景 ============ */
let scene, camera, renderer, clock;
let rainSystem, snowSystem, cloudGroup, sunLight, hemiLight, groundMesh, starSystem;
let isMobile = /Mobi|Android/i.test(navigator.userAgent);

initThree();
animate();

/* ============ 初始化 Three 场景 ============ */
function initThree(){
  const container = document.body;
  scene = new THREE.Scene();
  clock = new THREE.Clock();

  camera = new THREE.PerspectiveCamera(50, innerWidth/innerHeight, 0.1, 2000);
  camera.position.set(0, 10, 30);

  renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
  renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
  renderer.setSize(innerWidth, innerHeight);
  renderer.shadowMap.enabled = true;
  container.appendChild(renderer.domElement);

  // lights
  hemiLight = new THREE.HemisphereLight(0xffffff, 0x444444, 0.6);
  hemiLight.position.set(0, 50, 0);
  scene.add(hemiLight);

  sunLight = new THREE.DirectionalLight(0xffffff, 0.9);
  sunLight.castShadow = true;
  sunLight.shadow.camera.left = -50;
  sunLight.shadow.camera.right = 50;
  sunLight.shadow.camera.top = 50;
  sunLight.shadow.camera.bottom = -50;
  sunLight.shadow.mapSize.set(1024,1024);
  sunLight.position.set(30, 60, 20);
  scene.add(sunLight);

  // ground (reflective-ish plane)
  const groundGeo = new THREE.PlaneG
