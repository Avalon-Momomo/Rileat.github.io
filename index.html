<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>天气 · Apple 风格</title>
  <meta name="viewport" content="width=device-width,initial-scale=1.0">

  <style>
    * { box-sizing: border-box; }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", system-ui, sans-serif;
      color: #fff;
      display: flex;
      justify-content: center;
      align-items: stretch;
      padding: 16px;
      background: radial-gradient(circle at top, #5aa9ff, #1b2650);
      background-size: 200% 200%;
      animation: bgShift 25s ease-in-out infinite alternate;
      transition: background 1s ease;
    }

    @keyframes bgShift {
      0%   { background-position: 0% 0%; }
      100% { background-position: 100% 100%; }
    }

    /* 背景主题 */
    body.theme-sun {
      background: radial-gradient(circle at top, #55b2ff, #1c2a6a);
      background-size: 200% 200%;
      animation: bgShift 25s ease-in-out infinite alternate;
    }
    body.theme-cloud {
      background: radial-gradient(circle at top, #7e8fa6, #2d3a4f);
      background-size: 200% 200%;
      animation: bgShift 30s ease-in-out infinite alternate;
    }
    body.theme-rain {
      background: radial-gradient(circle at top, #556575, #1a2230);
      background-size: 200% 200%;
      animation: bgShift 22s ease-in-out infinite alternate;
    }
    body.theme-night {
      background: radial-gradient(circle at top, #121a33, #050710);
      background-size: 200% 200%;
      animation: bgShift 35s ease-in-out infinite alternate;
    }
    body.theme-snow {
      background: radial-gradient(circle at top, #9bc9ff, #355b8f);
      background-size: 200% 200%;
      animation: bgShift 26s ease-in-out infinite alternate;
    }

    .app {
      width: 100%;
      max-width: 960px;
      margin: auto;
      padding: 18px 16px 24px;
      border-radius: 32px;
      background: linear-gradient(145deg, rgba(255,255,255,0.12), rgba(255,255,255,0.03));
      backdrop-filter: blur(22px) saturate(1.2);
      -webkit-backdrop-filter: blur(22px) saturate(1.2);
      border: 1px solid rgba(255,255,255,0.2);
      box-shadow: 0 24px 60px rgba(0,0,0,0.45);
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    header.top {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }

    .city-block {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .city {
      font-size: 26px;
      font-weight: 600;
    }

    .time {
      font-size: 13px;
      opacity: 0.85;
    }

    .search-box {
      display: flex;
      gap: 8px;
      align-items: center;
    }
    .search-box input {
      padding: 8px 12px;
      border-radius: 999px;
      border: none;
      outline: none;
      font-size: 14px;
      background: rgba(255,255,255,0.18);
      color: #fff;
      min-width: 150px;
    }
    .search-box button {
      border-radius: 999px;
      border: none;
      padding: 8px 12px;
      font-size: 14px;
      background: rgba(255,255,255,0.22);
      color: #fff;
      font-weight: 500;
      cursor: pointer;
      white-space: nowrap;
    }

    .now {
      display: grid;
      grid-template-columns: minmax(0,1.3fr) minmax(0,1fr);
      gap: 8px;
      align-items: center;
    }

    @media (max-width: 640px) {
      .now {
        grid-template-columns: 1fr;
        row-gap: 12px;
      }
    }

    .temp {
      font-size: 72px;
      line-height: 1;
      font-weight: 600;
    }

    .temp-block {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .condition-main {
      font-size: 18px;
      opacity: 0.9;
    }

    .hi-lo {
      font-size: 14px;
      opacity: 0.9;
    }

    .right-now {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 6px;
    }

    .now-icon {
      width: 60px;
      height: 60px;
      filter: drop-shadow(0 4px 10px rgba(0,0,0,0.5));
    }

    .feels {
      font-size: 13px;
      opacity: 0.9;
    }

    .section-title {
      font-size: 14px;
      font-weight: 600;
      letter-spacing: .05em;
      text-transform: uppercase;
      opacity: 0.9;
      margin-bottom: 4px;
    }

    .today-grid {
      display: grid;
      grid-template-columns: repeat(3,minmax(0,1fr));
      gap: 8px;
    }

    @media (max-width: 640px) {
      .today-grid {
        grid-template-columns: repeat(2,minmax(0,1fr));
      }
    }

    .card-small {
      padding: 10px 12px;
      border-radius: 16px;
      background: rgba(0,0,0,0.16);
      border: 1px solid rgba(255,255,255,0.18);
      font-size: 13px;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .card-small-label {
      opacity: 0.8;
    }

    .card-small-value {
      font-size: 16px;
      font-weight: 500;
    }

    footer {
      margin-top: 4px;
      font-size: 11px;
      opacity: 0.8;
      display: flex;
      justify-content: space-between;
      gap: 8px;
      flex-wrap: wrap;
    }

    footer span {
      white-space: nowrap;
    }
  </style>
</head>
<body class="theme-sun">

<div class="app">
  <header class="top">
    <div class="city-block">
      <div class="city" id="city">加载中...</div>
      <div class="time" id="localtime">—</div>
    </div>

    <div class="search-box">
      <input id="search" placeholder="输入城市，例如 Sydney">
      <button id="searchBtn">搜索</button>
      <button id="locBtn">定位</button>
    </div>
  </header>

  <main>
    <section class="now">
      <div class="temp-block">
        <div class="temp" id="temp">--°</div>
        <div class="condition-main" id="condition">正在获取天气...</div>
        <div class="hi-lo" id="hiLo">最高 --° · 最低 --°</div>
      </div>

      <div class="right-now">
        <img id="icon" class="now-icon" src="" alt="">
        <div class="feels" id="feelsLike">体感：--°</div>
      </div>
    </section>

    <section>
      <div class="section-title">今日详情</div>
      <div class="today-grid">
        <div class="card-small">
          <div class="card-small-label">风速</div>
          <div class="card-small-value" id="wind">-- km/h</div>
        </div>
        <div class="card-small">
          <div class="card-small-label">湿度</div>
          <div class="card-small-value" id="humidity">--%</div>
        </div>
        <div class="card-small">
          <div class="card-small-label">紫外线指数</div>
          <div class="card-small-value" id="uv">--</div>
        </div>
        <div class="card-small">
          <div class="card-small-label">气压</div>
          <div class="card-small-value" id="pressure">-- hPa</div>
        </div>
        <div class="card-small">
          <div class="card-small-label">能见度</div>
          <div class="card-small-value" id="visibility">-- km</div>
        </div>
        <div class="card-small">
          <div class="card-small-label">云量</div>
          <div class="card-small-value" id="cloud">--%</div>
        </div>
      </div>
    </section>
  </main>

  <footer>
    <span>数据来源：WeatherAPI</span>
    <span id="updated">上次更新：—</span>
  </footer>
</div>

<script>
  const API_KEY = "0871934c91a1479984b40316250912";

  const cityEl       = document.getElementById("city");
  const timeEl       = document.getElementById("localtime");
  const tempEl       = document.getElementById("temp");
  const condEl       = document.getElementById("condition");
  const hiLoEl       = document.getElementById("hiLo");
  const iconEl       = document.getElementById("icon");
  const feelsEl      = document.getElementById("feelsLike");
  const windEl       = document.getElementById("wind");
  const humidityEl   = document.getElementById("humidity");
  const uvEl         = document.getElementById("uv");
  const pressureEl   = document.getElementById("pressure");
  const visEl        = document.getElementById("visibility");
  const cloudEl      = document.getElementById("cloud");
  const updatedEl    = document.getElementById("updated");

  const searchInput  = document.getElementById("search");
  const searchBtn    = document.getElementById("searchBtn");
  const locBtn       = document.getElementById("locBtn");

  searchBtn.addEventListener("click", () => {
    const val = searchInput.value.trim();
    if (!val) return;
    fetchWeatherByQuery(val);
  });

  searchInput.addEventListener("keydown", e => {
    if (e.key === "Enter") searchBtn.click();
  });

  locBtn.addEventListener("click", autoLocate);

  async function fetchWeatherByQuery(q) {
    try {
      const url = `https://api.weatherapi.com/v1/current.json?key=${API_KEY}&q=${encodeURIComponent(q)}&aqi=no`;
      const res = await fetch(url);
      const data = await res.json();
      if (data.error) throw new Error(data.error.message);
      updateUI(data);
    } catch (e) {
      alert("获取天气失败，请检查城市名后重试");
      console.error(e);
    }
  }

  function updateUI(data) {
    const loc = data.location;
    const c   = data.current;

    cityEl.textContent = `${loc.name}, ${loc.region || loc.country}`;
    timeEl.textContent = `当地时间：${loc.localtime}`;
    tempEl.textContent = `${Math.round(c.temp_c)}°`;
    condEl.textContent = c.condition.text;
    iconEl.src = "https:" + c.condition.icon;
    iconEl.alt = c.condition.text;

    // 模拟高低温（如果只用 current 接口，没有 forecast，就做一个大致范围）
    const hi = Math.round(c.temp_c + 2);
    const lo = Math.round(c.temp_c - 2);
    hiLoEl.textContent = `最高 ${hi}° · 最低 ${lo}°`;

    feelsEl.textContent    = `体感：${Math.round(c.feelslike_c)}°`;
    windEl.textContent     = `${c.wind_kph} km/h`;
    humidityEl.textContent = `${c.humidity}%`;
    uvEl.textContent       = `${c.uv}`;
    pressureEl.textContent = c.pressure_mb ? `${c.pressure_mb} hPa` : "—";
    visEl.textContent      = c.vis_km !== undefined ? `${c.vis_km} km` : "—";
    cloudEl.textContent    = c.cloud !== undefined ? `${c.cloud}%` : "—";

    const now = new Date();
    updatedEl.textContent = `上次更新：${now.toLocaleTimeString()}`;

    applyTheme(c.condition.text, c.is_day === 1, loc.localtime);
  }

  function applyTheme(condText, isDay, localtimeStr) {
    const text = (condText || "").toLowerCase();
    const body = document.body;

    // 简单判断白天/夜间
    let hour = null;
    if (localtimeStr) {
      const m = localtimeStr.match(/\d{4}-\d{2}-\d{2} (\d{2})/);
      if (m) hour = parseInt(m[1], 10);
    }
    const night = hour !== null ? (hour >= 20 || hour < 6) : !isDay;

    let theme = "theme-sun";
    if (night) {
      theme = "theme-night";
    } else if (/storm|雷/.test(text)) {
      theme = "theme-rain";
    } else if (/rain|阵雨|雨/.test(text)) {
      theme = "theme-rain";
    } else if (/snow|雪/.test(text)) {
      theme = "theme-snow";
    } else if (/cloud|多云|阴/.test(text)) {
      theme = "theme-cloud";
    } else if (/clear|晴/.test(text)) {
      theme = "theme-sun";
    }

    body.classList.remove("theme-sun","theme-cloud","theme-rain","theme-night","theme-snow");
    body.classList.add(theme);
  }

  function autoLocate() {
    if (!navigator.geolocation) {
      fetchWeatherByQuery("Sydney");
      return;
    }
    navigator.geolocation.getCurrentPosition(
      pos => {
        const q = `${pos.coords.latitude},${pos.coords.longitude}`;
        fetchWeatherByQuery(q);
      },
      err => {
        console.warn("定位失败，使用默认城市", err);
        fetchWeatherByQuery("Sydney");
      }
    );
  }

  // 初始加载：尝试定位
  autoLocate();
</script>

</body>
</html>
